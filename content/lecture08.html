
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>8. Machine Learning Basics &#8212; 2019 Chemiformatics OLCC</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=ca42572a" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/lecture08';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="7. Virtual Screening" href="lecture07.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">2019 Chemiformatics OLCC</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Intro
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lecture01.html">1. Getting Molecular Properties through PUG-REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture02.html">2. Chemical Structure Inputs for PUG-REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture03.html">3. Intercoversion between PubChem records.</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture04.html">4. Compound vs Substance</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture05.html">5. Structure Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture06.html">6. Molecular Similarity</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture07.html">7. Virtual Screening</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Machine Learning Basics</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://nanohub.org/tools/cheminf2019olcc/hub/user-redirect/git-pull?repo=https%3A//github.com/alex6786/2019CheminfoOLCCJupyterBook&urlpath=tree/2019CheminfoOLCCJupyterBook/content/lecture08.ipynb&branch=master" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/alex6786/2019CheminfoOLCCJupyterBook" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/lecture08.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Machine Learning Basics</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">8. Machine Learning Basics</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-bioactivity-data-from-pubchem">1. Import bioactivity data from PubChem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-number-of-compounds-for-each-activity-group">2. Check the number of compounds for each activity group</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#select-active-inactive-compounds-for-model-building">3. Select active/inactive compounds for model building</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drop-substances-without-associated-cids">3-(1) Drop substances without associated CIDs.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-cids-with-conflicting-activities">3-(2) Remove CIDs with conflicting activities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-redundant-data">3-(3) Remove redundant data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-numeric-activity-classes">3-(4) Adding “numeric” activity classes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-smaller-data-frame-that-only-contains-cids-and-activities">3-(5) Create a smaller data frame that only contains CIDs and activities.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-structure-information-for-each-compound-from-pubchem">4. Download structure information for each compound from PubChem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-maccs-keys-from-smiles">5. Generate MACCS keys from SMILES.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-activity-data-and-fingerprint-information">6. Merge activity data and fingerprint information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-for-model-building">7. Preparation for model building</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data-into-x-and-y">7-(1) Loading the data into X and y.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-zero-variance-features">7-(2) Remove zero-variance features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split-a-9-1-ratio">7-(3) Train-Test-Split (a 9:1 ratio)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#balance-the-training-set-through-downsampling">7-(4) Balance the training set through downsampling</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#build-a-model-using-the-training-set">9. 8. Build a model using the training set.</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-bayes">8-(1) Naive Bayes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-tree">8-(2) Decision Tree</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-building-through-cross-validation">9. Model building through cross-validation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">10. Exercises</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="machine-learning-basics">
<h1><span class="section-number">8. </span>Machine Learning Basics<a class="headerlink" href="#machine-learning-basics" title="Link to this heading">#</a></h1>
<section id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Build binary classification models that predict activity/inactivity of small molecules against human aromatase using supervised learning methods.</p></li>
<li><p>Evaluate the performance of the developed models using performance measures.</p></li>
</ul>
</section>
<section id="import-bioactivity-data-from-pubchem">
<h2>1. Import bioactivity data from PubChem<a class="headerlink" href="#import-bioactivity-data-from-pubchem" title="Link to this heading">#</a></h2>
<p>In this notebook, we will develop a prediction model for small molecule’s activity against human aromatase (<a class="reference external" href="https://pubchem.ncbi.nlm.nih.gov/protein/EAW77416">https://pubchem.ncbi.nlm.nih.gov/protein/EAW77416</a>), which is encoded by the CYP19A1 gene (<a class="reference external" href="https://pubchem.ncbi.nlm.nih.gov/gene/1588">https://pubchem.ncbi.nlm.nih.gov/gene/1588</a>). The model will predict the activity of a molecule based on the structure of the molecule (represented with molecular fingerprints).</p>
<p>For model development, we will use the Tox21 bioassay data for human aromatase, archived in PubChem (<a class="reference external" href="https://pubchem.ncbi.nlm.nih.gov/bioassay/743139">https://pubchem.ncbi.nlm.nih.gov/bioassay/743139</a>).  The bioactivity data presented on this page can be downloaded by clicking the “Download” button available on this page and then read the data into a data frame.  Alternatively, you can directly load the data into a data frame as shown in the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://pubchem.ncbi.nlm.nih.gov/assay/pcget.cgi?query=download&amp;record_type=datatable&amp;actvty=all&amp;response_type=save&amp;aid=743139&#39;</span>
<span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_raw</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PUBCHEM_RESULT_TAG</th>
      <th>PUBCHEM_SID</th>
      <th>PUBCHEM_CID</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>PUBCHEM_ACTIVITY_OUTCOME</th>
      <th>PUBCHEM_ACTIVITY_SCORE</th>
      <th>PUBCHEM_ACTIVITY_URL</th>
      <th>PUBCHEM_ASSAYDATA_COMMENT</th>
      <th>Activity Summary</th>
      <th>Antagonist Activity</th>
      <th>Antagonist Potency (uM)</th>
      <th>Antagonist Efficacy (%)</th>
      <th>Viability Activity</th>
      <th>Viability Potency (uM)</th>
      <th>Viability Efficacy (%)</th>
      <th>Sample Source</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RESULT_TYPE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>STRING</td>
      <td>STRING</td>
      <td>FLOAT</td>
      <td>FLOAT</td>
      <td>STRING</td>
      <td>FLOAT</td>
      <td>FLOAT</td>
      <td>STRING</td>
    </tr>
    <tr>
      <th>1</th>
      <td>RESULT_DESCR</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Type of compound activity based on both the ar...</td>
      <td>Type of compound activity in the aromatase ant...</td>
      <td>The concentration of sample yielding half-maxi...</td>
      <td>Percent inhibition of aromatase.</td>
      <td>Type of compound activity in the cell viabilit...</td>
      <td>The concentration of sample yielding half-maxi...</td>
      <td>Percent inhibition of cell viability.</td>
      <td>Where sample was obtained.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>RESULT_UNIT</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>MICROMOLAR</td>
      <td>PERCENT</td>
      <td>NaN</td>
      <td>MICROMOLAR</td>
      <td>PERCENT</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>144203552.0</td>
      <td>12850184.0</td>
      <td>C(C(=O)[C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O.C(...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>144203553.0</td>
      <td>89753.0</td>
      <td>C([C@H]([C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O)O...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>144203554.0</td>
      <td>9403.0</td>
      <td>C[C@]12CC[C@H]3[C@H]([C@@H]1CC[C@@H]2OC(=O)CCC...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4</td>
      <td>144203555.0</td>
      <td>13218779.0</td>
      <td>C[C@@]12CC[C@@H](C1(C)C)C[C@H]2OC(=O)CSC#N</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Note:</strong> Lines 0-2 provide the descriptions for each column (data type, descriptions, units, etc).  These rows need be removed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_raw</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
<span class="n">df_raw</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PUBCHEM_RESULT_TAG</th>
      <th>PUBCHEM_SID</th>
      <th>PUBCHEM_CID</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>PUBCHEM_ACTIVITY_OUTCOME</th>
      <th>PUBCHEM_ACTIVITY_SCORE</th>
      <th>PUBCHEM_ACTIVITY_URL</th>
      <th>PUBCHEM_ASSAYDATA_COMMENT</th>
      <th>Activity Summary</th>
      <th>Antagonist Activity</th>
      <th>Antagonist Potency (uM)</th>
      <th>Antagonist Efficacy (%)</th>
      <th>Viability Activity</th>
      <th>Viability Potency (uM)</th>
      <th>Viability Efficacy (%)</th>
      <th>Sample Source</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>144203552.0</td>
      <td>12850184.0</td>
      <td>C(C(=O)[C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O.C(...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>144203553.0</td>
      <td>89753.0</td>
      <td>C([C@H]([C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O)O...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>144203554.0</td>
      <td>9403.0</td>
      <td>C[C@]12CC[C@H]3[C@H]([C@@H]1CC[C@@H]2OC(=O)CCC...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4</td>
      <td>144203555.0</td>
      <td>13218779.0</td>
      <td>C[C@@]12CC[C@@H](C1(C)C)C[C@H]2OC(=O)CSC#N</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>7</th>
      <td>5</td>
      <td>144203556.0</td>
      <td>142766.0</td>
      <td>C1=CC=C(C(=C1)C(=O)O)O.C1=CC2=C(C(=C1)O)N=CC=C2</td>
      <td>Inconclusive</td>
      <td>25.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inconclusive antagonist (cytotoxic)</td>
      <td>active antagonist</td>
      <td>15.5454</td>
      <td>-115.803</td>
      <td>active antagonist</td>
      <td>14.9601</td>
      <td>-76.8218</td>
      <td>NCI</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The column names in this data frame contain white spaces and special characters.  For simplicity, let’s rename the columns (no spaces or special characters except for the “_” character.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_raw</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;PUBCHEM_RESULT_TAG&#39;, &#39;PUBCHEM_SID&#39;, &#39;PUBCHEM_CID&#39;,
       &#39;PUBCHEM_EXT_DATASOURCE_SMILES&#39;, &#39;PUBCHEM_ACTIVITY_OUTCOME&#39;,
       &#39;PUBCHEM_ACTIVITY_SCORE&#39;, &#39;PUBCHEM_ACTIVITY_URL&#39;,
       &#39;PUBCHEM_ASSAYDATA_COMMENT&#39;, &#39;Activity Summary&#39;, &#39;Antagonist Activity&#39;,
       &#39;Antagonist Potency (uM)&#39;, &#39;Antagonist Efficacy (%)&#39;,
       &#39;Viability Activity&#39;, &#39;Viability Potency (uM)&#39;,
       &#39;Viability Efficacy (%)&#39;, &#39;Sample Source&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col_names_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PUBCHEM_RESULT_TAG&#39;</span> <span class="p">:</span> <span class="s1">&#39;pc_result_tag&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;PUBCHEM_SID&#39;</span> <span class="p">:</span> <span class="s1">&#39;sid&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;PUBCHEM_CID&#39;</span> <span class="p">:</span> <span class="s1">&#39;cid&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;PUBCHEM_ACTIVITY_OUTCOME&#39;</span> <span class="p">:</span> <span class="s1">&#39;activity_outcome&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;PUBCHEM_ACTIVITY_SCORE&#39;</span> <span class="p">:</span> <span class="s1">&#39;activity_score&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;PUBCHEM_ACTIVITY_URL&#39;</span> <span class="p">:</span> <span class="s1">&#39;activity_url&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;PUBCHEM_ASSAYDATA_COMMENT&#39;</span> <span class="p">:</span> <span class="s1">&#39;assay_data_comment&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;Activity Summary&#39;</span> <span class="p">:</span> <span class="s1">&#39;activity_summary&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Antagonist Activity&#39;</span> <span class="p">:</span> <span class="s1">&#39;antagonist_activity&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;Antagonist Potency (uM)&#39;</span> <span class="p">:</span> <span class="s1">&#39;antagonist_potency&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;Antagonist Efficacy (%)&#39;</span> <span class="p">:</span> <span class="s1">&#39;antagonist_efficacy&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Viability Activity&#39;</span> <span class="p">:</span> <span class="s1">&#39;viability_activity&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;Viability Potency (uM)&#39;</span> <span class="p">:</span> <span class="s1">&#39;viability_potency&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Viability Efficacy (%)&#39;</span> <span class="p">:</span> <span class="s1">&#39;viability_efficacy&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;Sample Source&#39;</span> <span class="p">:</span> <span class="s1">&#39;sample_source&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_raw</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">col_names_map</span><span class="p">)</span>
<span class="n">df_raw</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;pc_result_tag&#39;, &#39;sid&#39;, &#39;cid&#39;, &#39;PUBCHEM_EXT_DATASOURCE_SMILES&#39;,
       &#39;activity_outcome&#39;, &#39;activity_score&#39;, &#39;activity_url&#39;,
       &#39;assay_data_comment&#39;, &#39;activity_summary&#39;, &#39;antagonist_activity&#39;,
       &#39;antagonist_potency&#39;, &#39;antagonist_efficacy&#39;, &#39;viability_activity&#39;,
       &#39;viability_potency&#39;, &#39;viability_efficacy&#39;, &#39;sample_source&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-the-number-of-compounds-for-each-activity-group">
<h2>2. Check the number of compounds for each activity group<a class="headerlink" href="#check-the-number-of-compounds-for-each-activity-group" title="Link to this heading">#</a></h2>
<p>First, we need to understand what our data look like.  Especially, we are interested in the activity class of the tested compounds because we are developing a model that classifies small molecules according to their activities against the target.  This information is available in the “<strong>activity_outcome</strong>” and “<strong>activity_summary</strong>” columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_raw</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;activity_outcome&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pc_result_tag</th>
      <th>sid</th>
      <th>cid</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>activity_score</th>
      <th>activity_url</th>
      <th>assay_data_comment</th>
      <th>activity_summary</th>
      <th>antagonist_activity</th>
      <th>antagonist_potency</th>
      <th>antagonist_efficacy</th>
      <th>viability_activity</th>
      <th>viability_potency</th>
      <th>viability_efficacy</th>
      <th>sample_source</th>
    </tr>
    <tr>
      <th>activity_outcome</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Active</th>
      <td>379</td>
      <td>379</td>
      <td>378</td>
      <td>378</td>
      <td>379</td>
      <td>0</td>
      <td>0</td>
      <td>379</td>
      <td>379</td>
      <td>378</td>
      <td>379</td>
      <td>379</td>
      <td>115</td>
      <td>359</td>
      <td>379</td>
    </tr>
    <tr>
      <th>Inactive</th>
      <td>7562</td>
      <td>7562</td>
      <td>7466</td>
      <td>7466</td>
      <td>7562</td>
      <td>0</td>
      <td>0</td>
      <td>7562</td>
      <td>7562</td>
      <td>0</td>
      <td>7562</td>
      <td>7562</td>
      <td>324</td>
      <td>7449</td>
      <td>7562</td>
    </tr>
    <tr>
      <th>Inconclusive</th>
      <td>2545</td>
      <td>2545</td>
      <td>2493</td>
      <td>2493</td>
      <td>2545</td>
      <td>0</td>
      <td>0</td>
      <td>2545</td>
      <td>2545</td>
      <td>2111</td>
      <td>2136</td>
      <td>2545</td>
      <td>1206</td>
      <td>2450</td>
      <td>2545</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Based on the data in the <strong>activity_outcome</strong> column, there are 379 actives, 7562 inactives, and 2545 inconclusives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_raw</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;activity_outcome&#39;</span><span class="p">,</span><span class="s1">&#39;activity_summary&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>pc_result_tag</th>
      <th>sid</th>
      <th>cid</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>activity_score</th>
      <th>activity_url</th>
      <th>assay_data_comment</th>
      <th>antagonist_activity</th>
      <th>antagonist_potency</th>
      <th>antagonist_efficacy</th>
      <th>viability_activity</th>
      <th>viability_potency</th>
      <th>viability_efficacy</th>
      <th>sample_source</th>
    </tr>
    <tr>
      <th>activity_outcome</th>
      <th>activity_summary</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Active</th>
      <th>active antagonist</th>
      <td>379</td>
      <td>379</td>
      <td>378</td>
      <td>378</td>
      <td>379</td>
      <td>0</td>
      <td>0</td>
      <td>379</td>
      <td>378</td>
      <td>379</td>
      <td>379</td>
      <td>115</td>
      <td>359</td>
      <td>379</td>
    </tr>
    <tr>
      <th>Inactive</th>
      <th>inactive</th>
      <td>7562</td>
      <td>7562</td>
      <td>7466</td>
      <td>7466</td>
      <td>7562</td>
      <td>0</td>
      <td>0</td>
      <td>7562</td>
      <td>0</td>
      <td>7562</td>
      <td>7562</td>
      <td>324</td>
      <td>7449</td>
      <td>7562</td>
    </tr>
    <tr>
      <th rowspan="6" valign="top">Inconclusive</th>
      <th>active agonist</th>
      <td>612</td>
      <td>612</td>
      <td>571</td>
      <td>571</td>
      <td>612</td>
      <td>0</td>
      <td>0</td>
      <td>612</td>
      <td>612</td>
      <td>612</td>
      <td>612</td>
      <td>60</td>
      <td>590</td>
      <td>612</td>
    </tr>
    <tr>
      <th>inconclusive</th>
      <td>44</td>
      <td>44</td>
      <td>44</td>
      <td>44</td>
      <td>44</td>
      <td>0</td>
      <td>0</td>
      <td>44</td>
      <td>0</td>
      <td>0</td>
      <td>44</td>
      <td>19</td>
      <td>42</td>
      <td>44</td>
    </tr>
    <tr>
      <th>inconclusive agonist</th>
      <td>414</td>
      <td>414</td>
      <td>409</td>
      <td>409</td>
      <td>414</td>
      <td>0</td>
      <td>0</td>
      <td>414</td>
      <td>212</td>
      <td>223</td>
      <td>414</td>
      <td>12</td>
      <td>397</td>
      <td>414</td>
    </tr>
    <tr>
      <th>inconclusive agonist (cytotoxic)</th>
      <td>59</td>
      <td>59</td>
      <td>59</td>
      <td>59</td>
      <td>59</td>
      <td>0</td>
      <td>0</td>
      <td>59</td>
      <td>41</td>
      <td>45</td>
      <td>59</td>
      <td>59</td>
      <td>59</td>
      <td>59</td>
    </tr>
    <tr>
      <th>inconclusive antagonist</th>
      <td>367</td>
      <td>367</td>
      <td>364</td>
      <td>364</td>
      <td>367</td>
      <td>0</td>
      <td>0</td>
      <td>367</td>
      <td>227</td>
      <td>230</td>
      <td>367</td>
      <td>8</td>
      <td>313</td>
      <td>367</td>
    </tr>
    <tr>
      <th>inconclusive antagonist (cytotoxic)</th>
      <td>1049</td>
      <td>1049</td>
      <td>1046</td>
      <td>1046</td>
      <td>1049</td>
      <td>0</td>
      <td>0</td>
      <td>1049</td>
      <td>1019</td>
      <td>1026</td>
      <td>1049</td>
      <td>1048</td>
      <td>1049</td>
      <td>1049</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now, we can see that, in the <strong>activity_summary</strong> column, the inconclusive compounds are further classified into subclasses, which include:</p>
<ul class="simple">
<li><p><strong>active agonist</strong></p></li>
<li><p>inconclusive</p></li>
<li><p>inconclusive agonist</p></li>
<li><p>inconclusive antagonist</p></li>
<li><p>inconclusive agonist (cytotoxic)</p></li>
<li><p>inconclusive antagonist (cytotoxic)</p></li>
</ul>
<p>As implied in the title of this assay record (<a class="reference external" href="https://pubchem.ncbi.nlm.nih.gov/bioassay/743139">https://pubchem.ncbi.nlm.nih.gov/bioassay/743139</a>), this assay aims to identify <strong>aromatase inhibitors</strong>.  Therefore, all <strong>active antagonists</strong> (in the activity summary column) were declared to be <strong>active</strong> compounds (in the activity outcome column).</p>
<p>On the other hand, the assay also identified 612 <strong>active agonists</strong> (in the activity summary column), and they are declared to be <strong>inconclusive</strong> (in the activity outcome column).</p>
<p>With that said, “inactive” compounds in this assay means those which are neither active agonists nor active antagonist.</p>
<p>It is important to understand that the criteria used for determining whether a compound is active or not in a given assay are selected by the data source who submitted that assay data to PubChem.  For the purpose of this assignment (which aims to develop a binary classifier that tells if a molecule is active or inactive against the target), we should clarify what we mean by “active” and “inactive”.</p>
<ul class="simple">
<li><p><strong>active</strong> : any compounds that can change (either increase or decrease) the activity of the target.  This is equivalent to either <strong>active antagonists</strong> or <strong>active agonists</strong> in the activity summary column.</p></li>
<li><p><strong>inactive</strong> : any compounds that do not change the activity of the target.  This is equivalent to <strong>inactive</strong> compounds in the activity summary column.</p></li>
</ul>
</section>
<section id="select-active-inactive-compounds-for-model-building">
<h2>3. Select active/inactive compounds for model building<a class="headerlink" href="#select-active-inactive-compounds-for-model-building" title="Link to this heading">#</a></h2>
<p>Now we want to select only the active and inactive compounds from the data frame (that is, active agonists, active antagonists, and inactives based on the “activity summary” column).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span> <span class="p">(</span><span class="n">df_raw</span><span class="p">[</span><span class="s1">&#39;activity_summary&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;active agonist&#39;</span> <span class="p">)</span> <span class="o">|</span> 
             <span class="p">(</span><span class="n">df_raw</span><span class="p">[</span><span class="s1">&#39;activity_summary&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;active antagonist&#39;</span> <span class="p">)</span> <span class="o">|</span>
             <span class="p">(</span><span class="n">df_raw</span><span class="p">[</span><span class="s1">&#39;activity_summary&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inactive&#39;</span> <span class="p">)</span> <span class="p">]</span>

<span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8553
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8553
6858
</pre></div>
</div>
</div>
</div>
<p>Note that the number of CIDs is not the same as the number of SIDs.  There are two important potential reasons for this observation.</p>
<p>First, not all substances (SIDs) in PubChem have associated compounds (CIDs) because some substances failed during structure standardization.  [Remember that, in PubChem, substances are depositor-provided structures and compounds are unique structures extracted from substances through structure standardization.]  Because our model will use structural information of molecules to predict their bioactivity, we need to remove substances without associated CIDs (i.e., no standardized structures).</p>
<p>Second, some compounds are associated with more than one substances.  In the context of this assay, it means that a compound may be tested multiple times in different samples (which are designated as different substances).  It is not uncommon that different samples of the same chemical may result in conflicting activities (e.g., active agonist in one sample but inactive in another sample).  In this practice, we remove such compounds with conflicting activities.</p>
</section>
<section id="drop-substances-without-associated-cids">
<h2>3-(1) Drop substances without associated CIDs.<a class="headerlink" href="#drop-substances-without-associated-cids" title="Link to this heading">#</a></h2>
<p>First, check if there are subtances without associated CIDs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pc_result_tag                       0
sid                                 0
cid                               138
PUBCHEM_EXT_DATASOURCE_SMILES     138
activity_outcome                    0
activity_score                      0
activity_url                     8553
assay_data_comment               8553
activity_summary                    0
antagonist_activity                 0
antagonist_potency               7563
antagonist_efficacy                 0
viability_activity                  0
viability_potency                8054
viability_efficacy                155
sample_source                       0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>There are 138 records whose “cid” column is NULL, and we want to remove those records.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8415
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8415
6857
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>   <span class="c1"># Check if the NULL values disappeared in the &quot;cid&quot; column</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pc_result_tag                       0
sid                                 0
cid                                 0
PUBCHEM_EXT_DATASOURCE_SMILES       0
activity_outcome                    0
activity_score                      0
activity_url                     8415
assay_data_comment               8415
activity_summary                    0
antagonist_activity                 0
antagonist_potency               7467
antagonist_efficacy                 0
viability_activity                  0
viability_potency                7919
viability_efficacy                154
sample_source                       0
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="remove-cids-with-conflicting-activities">
<h2>3-(2) Remove CIDs with conflicting activities<a class="headerlink" href="#remove-cids-with-conflicting-activities" title="Link to this heading">#</a></h2>
<p>Now identify compounds with conflicting activities and remove them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cid_conflict</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">idx_conflict</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">mycid</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="p">:</span>
    
    <span class="n">outcomes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="n">mycid</span> <span class="p">]</span><span class="o">.</span><span class="n">activity_summary</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span>
        
        <span class="n">idx_tmp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="n">mycid</span> <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">idx_conflict</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">idx_tmp</span><span class="p">)</span>
        <span class="n">cid_conflict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mycid</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cid_conflict</span><span class="p">),</span> <span class="s2">&quot;CIDs with conflicting activities [associated with&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_conflict</span><span class="p">),</span> <span class="s2">&quot;rows (SIDs).]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># 66 CIDs with conflicting activities [associated with 150 rows (SIDs).]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_conflict</span><span class="p">,:]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pc_result_tag</th>
      <th>sid</th>
      <th>cid</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>activity_outcome</th>
      <th>activity_score</th>
      <th>activity_url</th>
      <th>assay_data_comment</th>
      <th>activity_summary</th>
      <th>antagonist_activity</th>
      <th>antagonist_potency</th>
      <th>antagonist_efficacy</th>
      <th>viability_activity</th>
      <th>viability_potency</th>
      <th>viability_efficacy</th>
      <th>sample_source</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>6</td>
      <td>144203557.0</td>
      <td>16043.0</td>
      <td>CC(C)(C)C1=C(C=CC(=C1)O)O</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>5956</th>
      <td>5954</td>
      <td>144209507.0</td>
      <td>16043.0</td>
      <td>CC(C)(C)C1=C(C=CC(=C1)O)O</td>
      <td>Active</td>
      <td>43.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>active antagonist</td>
      <td>active antagonist</td>
      <td>54.4827</td>
      <td>-73.4024</td>
      <td>inconclusive antagonist</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>SigmaAldrich</td>
    </tr>
    <tr>
      <th>6850</th>
      <td>6848</td>
      <td>144210401.0</td>
      <td>16043.0</td>
      <td>CC(C)(C)C1=C(C=CC(=C1)O)O</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>SIGMA</td>
    </tr>
    <tr>
      <th>52</th>
      <td>50</td>
      <td>144203601.0</td>
      <td>443939.0</td>
      <td>C[C@H]1[C@H]([C@H](C[C@@H](O1)O[C@H]2C[C@@](CC...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
    </tr>
    <tr>
      <th>6130</th>
      <td>6128</td>
      <td>144209681.0</td>
      <td>443939.0</td>
      <td>C[C@H]1[C@H]([C@H](C[C@@H](O1)O[C@H]2C[C@@](CC...</td>
      <td>Active</td>
      <td>61.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>active antagonist</td>
      <td>active antagonist</td>
      <td>1.65519</td>
      <td>-115.932</td>
      <td>active antagonist</td>
      <td>12.1763</td>
      <td>-120.598</td>
      <td>Toronto Research</td>
    </tr>
    <tr>
      <th>66</th>
      <td>64</td>
      <td>144203615.0</td>
      <td>2170.0</td>
      <td>C1CN(CCN1)C2=NC3=CC=CC=C3OC4=C2C=C(C=C4)Cl</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>BIOMOL</td>
    </tr>
    <tr>
      <th>9118</th>
      <td>9116</td>
      <td>144212669.0</td>
      <td>2170.0</td>
      <td>C1CN(CCN1)C2=NC3=CC=CC=C3OC4=C2C=C(C=C4)Cl</td>
      <td>Active</td>
      <td>50.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>active antagonist</td>
      <td>active antagonist</td>
      <td>16.5803</td>
      <td>-115.202</td>
      <td>inconclusive antagonist</td>
      <td>61.1306</td>
      <td>-80.7706</td>
      <td>SIGMA</td>
    </tr>
    <tr>
      <th>106</th>
      <td>104</td>
      <td>144203655.0</td>
      <td>2554.0</td>
      <td>C1=CC=C2C(=C1)C=CC3=CC=CC=C3N2C(=O)N</td>
      <td>Inconclusive</td>
      <td>20.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>active agonist</td>
      <td>active agonist</td>
      <td>2.87255</td>
      <td>73.7025</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>SigmaAldrich</td>
    </tr>
    <tr>
      <th>5920</th>
      <td>5918</td>
      <td>144209471.0</td>
      <td>2554.0</td>
      <td>C1=CC=C2C(=C1)C=CC3=CC=CC=C3N2C(=O)N</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>SIGMA</td>
    </tr>
    <tr>
      <th>6964</th>
      <td>6962</td>
      <td>144210515.0</td>
      <td>2554.0</td>
      <td>C1=CC=C2C(=C1)C=CC3=CC=CC=C3N2C(=O)N</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>SIGMA</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx_conflict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;activity_summary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pc_result_tag</th>
      <th>sid</th>
      <th>cid</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>activity_outcome</th>
      <th>activity_score</th>
      <th>activity_url</th>
      <th>assay_data_comment</th>
      <th>antagonist_activity</th>
      <th>antagonist_potency</th>
      <th>antagonist_efficacy</th>
      <th>viability_activity</th>
      <th>viability_potency</th>
      <th>viability_efficacy</th>
      <th>sample_source</th>
    </tr>
    <tr>
      <th>activity_summary</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>active agonist</th>
      <td>537</td>
      <td>537</td>
      <td>537</td>
      <td>537</td>
      <td>537</td>
      <td>537</td>
      <td>0</td>
      <td>0</td>
      <td>537</td>
      <td>537</td>
      <td>537</td>
      <td>537</td>
      <td>58</td>
      <td>517</td>
      <td>537</td>
    </tr>
    <tr>
      <th>active antagonist</th>
      <td>342</td>
      <td>342</td>
      <td>342</td>
      <td>342</td>
      <td>342</td>
      <td>342</td>
      <td>0</td>
      <td>0</td>
      <td>342</td>
      <td>341</td>
      <td>342</td>
      <td>342</td>
      <td>108</td>
      <td>326</td>
      <td>342</td>
    </tr>
    <tr>
      <th>inactive</th>
      <td>7386</td>
      <td>7386</td>
      <td>7386</td>
      <td>7386</td>
      <td>7386</td>
      <td>7386</td>
      <td>0</td>
      <td>0</td>
      <td>7386</td>
      <td>0</td>
      <td>7386</td>
      <td>7386</td>
      <td>318</td>
      <td>7275</td>
      <td>7386</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8265
6791
</pre></div>
</div>
</div>
</div>
</section>
<section id="remove-redundant-data">
<h2>3-(3) Remove redundant data<a class="headerlink" href="#remove-redundant-data" title="Link to this heading">#</a></h2>
<p>The above code cells [in 3-(2)] do not remove compounds tested multiple times if the testing results are consistent [e.g., active agonist in all samples (substances)].  The rows corresponding to these compounds are redundant, so we want remove them except for only one row for each compound.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;cid&#39;</span><span class="p">)</span>  <span class="c1"># remove duplicate rows except for the first occurring row.</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6791
6791
</pre></div>
</div>
</div>
</div>
</section>
<section id="adding-numeric-activity-classes">
<h2>3-(4) Adding “numeric” activity classes<a class="headerlink" href="#adding-numeric-activity-classes" title="Link to this heading">#</a></h2>
<p>In general, the inputs and outputs to machine learning algorithms need to have numerical forms.<br />
In this practice, the input (molecular structure) will be represented with binary fingerprints, which already have numerical forms (0 or 1).  However, the output (activity) is currently in a string format (e.g., ‘active agonist’, ‘active antagonist’).  Therefore, we want to add an additional, ‘activity’ column, which contains numeric codes representing the active and inactive compounds:</p>
<ul class="simple">
<li><p>1 for actives (either active agonists or active antagonists)</p></li>
<li><p>0 for inactives</p></li>
</ul>
<p>Note that we are merging the two classes “active agonist” and “active antagonist”, because we are going to build a binary classifer that distinguish actives from inactives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;activity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;inactive&#39;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;activity_summary&#39;</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Check if the new column ‘activity’ is added to (the end of) the data frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pc_result_tag</th>
      <th>sid</th>
      <th>cid</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>activity_outcome</th>
      <th>activity_score</th>
      <th>activity_url</th>
      <th>assay_data_comment</th>
      <th>activity_summary</th>
      <th>antagonist_activity</th>
      <th>antagonist_potency</th>
      <th>antagonist_efficacy</th>
      <th>viability_activity</th>
      <th>viability_potency</th>
      <th>viability_efficacy</th>
      <th>sample_source</th>
      <th>activity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>144203552.0</td>
      <td>12850184.0</td>
      <td>C(C(=O)[C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O.C(...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>144203553.0</td>
      <td>89753.0</td>
      <td>C([C@H]([C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O)O...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>144203554.0</td>
      <td>9403.0</td>
      <td>C[C@]12CC[C@H]3[C@H]([C@@H]1CC[C@@H]2OC(=O)CCC...</td>
      <td>Inactive</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>inactive</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>inactive</td>
      <td>NaN</td>
      <td>0</td>
      <td>NCI</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Double-check the count of active/inactive compounds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;activity_summary&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pc_result_tag</th>
      <th>sid</th>
      <th>cid</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>activity_outcome</th>
      <th>activity_score</th>
      <th>activity_url</th>
      <th>assay_data_comment</th>
      <th>antagonist_activity</th>
      <th>antagonist_potency</th>
      <th>antagonist_efficacy</th>
      <th>viability_activity</th>
      <th>viability_potency</th>
      <th>viability_efficacy</th>
      <th>sample_source</th>
      <th>activity</th>
    </tr>
    <tr>
      <th>activity_summary</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>active agonist</th>
      <td>451</td>
      <td>451</td>
      <td>451</td>
      <td>451</td>
      <td>451</td>
      <td>451</td>
      <td>0</td>
      <td>0</td>
      <td>451</td>
      <td>451</td>
      <td>451</td>
      <td>451</td>
      <td>44</td>
      <td>432</td>
      <td>451</td>
      <td>451</td>
    </tr>
    <tr>
      <th>active antagonist</th>
      <td>290</td>
      <td>290</td>
      <td>290</td>
      <td>290</td>
      <td>290</td>
      <td>290</td>
      <td>0</td>
      <td>0</td>
      <td>290</td>
      <td>289</td>
      <td>290</td>
      <td>290</td>
      <td>88</td>
      <td>275</td>
      <td>290</td>
      <td>290</td>
    </tr>
    <tr>
      <th>inactive</th>
      <td>6050</td>
      <td>6050</td>
      <td>6050</td>
      <td>6050</td>
      <td>6050</td>
      <td>6050</td>
      <td>0</td>
      <td>0</td>
      <td>6050</td>
      <td>0</td>
      <td>6050</td>
      <td>6050</td>
      <td>269</td>
      <td>5964</td>
      <td>6050</td>
      <td>6050</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pc_result_tag</th>
      <th>sid</th>
      <th>cid</th>
      <th>PUBCHEM_EXT_DATASOURCE_SMILES</th>
      <th>activity_outcome</th>
      <th>activity_score</th>
      <th>activity_url</th>
      <th>assay_data_comment</th>
      <th>activity_summary</th>
      <th>antagonist_activity</th>
      <th>antagonist_potency</th>
      <th>antagonist_efficacy</th>
      <th>viability_activity</th>
      <th>viability_potency</th>
      <th>viability_efficacy</th>
      <th>sample_source</th>
    </tr>
    <tr>
      <th>activity</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6050</td>
      <td>6050</td>
      <td>6050</td>
      <td>6050</td>
      <td>6050</td>
      <td>6050</td>
      <td>0</td>
      <td>0</td>
      <td>6050</td>
      <td>6050</td>
      <td>0</td>
      <td>6050</td>
      <td>6050</td>
      <td>269</td>
      <td>5964</td>
      <td>6050</td>
    </tr>
    <tr>
      <th>1</th>
      <td>741</td>
      <td>741</td>
      <td>741</td>
      <td>741</td>
      <td>741</td>
      <td>741</td>
      <td>0</td>
      <td>0</td>
      <td>741</td>
      <td>741</td>
      <td>740</td>
      <td>741</td>
      <td>741</td>
      <td>132</td>
      <td>707</td>
      <td>741</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="create-a-smaller-data-frame-that-only-contains-cids-and-activities">
<h2>3-(5) Create a smaller data frame that only contains CIDs and activities.<a class="headerlink" href="#create-a-smaller-data-frame-that-only-contains-cids-and-activities" title="Link to this heading">#</a></h2>
<p>Let’s create a smaller data frame that only contains CIDs and activities.  This data frame will be merged with a data frame containing molecular fingerprint information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_activity</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cid&#39;</span><span class="p">,</span><span class="s1">&#39;activity&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_activity</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>activity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>12850184.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>89753.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>9403.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>13218779.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>637566.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="download-structure-information-for-each-compound-from-pubchem">
<h2>4. Download structure information for each compound from PubChem<a class="headerlink" href="#download-structure-information-for-each-compound-from-pubchem" title="Link to this heading">#</a></h2>
<p>Now we want to get structure information of the compounds from PubChem (in isomeric SMILES).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cids</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cid</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">num_cids</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cids</span><span class="p">)</span>

<span class="k">if</span> <span class="n">num_cids</span> <span class="o">%</span> <span class="n">chunk_size</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
    <span class="n">num_chunks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">num_cids</span> <span class="o">/</span> <span class="n">chunk_size</span> <span class="p">)</span>
<span class="k">else</span> <span class="p">:</span>
    <span class="n">num_chunks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">num_cids</span> <span class="o">/</span> <span class="n">chunk_size</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# CIDs = &quot;</span><span class="p">,</span> <span class="n">num_cids</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# CID Chunks = &quot;</span><span class="p">,</span> <span class="n">num_chunks</span><span class="p">,</span> <span class="s2">&quot;(chunked by &quot;</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># CIDs =  6791
# CID Chunks =  34 (chunked by  200 )
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="n">df_smiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># temporary list of data frames</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_chunks</span><span class="p">)</span> <span class="p">:</span>
    
    <span class="n">idx1</span> <span class="o">=</span> <span class="n">chunk_size</span> <span class="o">*</span> <span class="n">i</span>
    <span class="n">idx2</span> <span class="o">=</span> <span class="n">chunk_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cidstr</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cids</span><span class="p">[</span><span class="n">idx1</span><span class="p">:</span><span class="n">idx2</span><span class="p">]</span> <span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/&#39;</span> <span class="o">+</span> <span class="n">cidstr</span> <span class="o">+</span> <span class="s1">&#39;/property/IsomericSMILES/TXT&#39;</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">list_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing Chunk &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>   

<span class="c1">#    if ( i == 2 ) : break  #- for debugging</span>

<span class="n">df_smiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_smiles</span><span class="p">[</span> <span class="s1">&#39;cid&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">cids</span>
<span class="n">df_smiles</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing Chunk  0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing Chunk  5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing Chunk  10
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing Chunk  15
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing Chunk  20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing Chunk  25
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing Chunk  30
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">line</span> <span class="mi">27</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="c1">#    if ( i == 2 ) : break  #- for debugging</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="n">df_smiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">27</span> <span class="n">df_smiles</span><span class="p">[</span> <span class="s1">&#39;cid&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">cids</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="n">df_smiles</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="nn">File ~/Desktop/my-book-files/venv/lib64/python3.9/site-packages/pandas/core/frame.py:4316,</span> in <span class="ni">DataFrame.__setitem__</span><span class="nt">(self, key, value)</span>
<span class="g g-Whitespace">   </span><span class="mi">4313</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_array</span><span class="p">([</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">4314</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">4315</span>     <span class="c1"># set column</span>
<span class="ne">-&gt; </span><span class="mi">4316</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_set_item</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="nn">File ~/Desktop/my-book-files/venv/lib64/python3.9/site-packages/pandas/core/frame.py:4529,</span> in <span class="ni">DataFrame._set_item</span><span class="nt">(self, key, value)</span>
<span class="g g-Whitespace">   </span><span class="mi">4519</span> <span class="k">def</span><span class="w"> </span><span class="nf">_set_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">4520</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4521</span><span class="sd">     Add series to DataFrame in specified column.</span>
<span class="g g-Whitespace">   </span><span class="mi">4522</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">4527</span><span class="sd">     ensure homogeneity.</span>
<span class="g g-Whitespace">   </span><span class="mi">4528</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">4529</span>     <span class="n">value</span><span class="p">,</span> <span class="n">refs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">4531</span>     <span class="k">if</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">4532</span>         <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
<span class="g g-Whitespace">   </span><span class="mi">4533</span>         <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
<span class="g g-Whitespace">   </span><span class="mi">4534</span>         <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">ExtensionDtype</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">4535</span>     <span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">4536</span>         <span class="c1"># broadcast across multiple columns if necessary</span>
<span class="g g-Whitespace">   </span><span class="mi">4537</span>         <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">is_unique</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">MultiIndex</span><span class="p">):</span>

<span class="nn">File ~/Desktop/my-book-files/venv/lib64/python3.9/site-packages/pandas/core/frame.py:5273,</span> in <span class="ni">DataFrame._sanitize_column</span><span class="nt">(self, value)</span>
<span class="g g-Whitespace">   </span><span class="mi">5270</span>     <span class="k">return</span> <span class="n">_reindex_for_setitem</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5272</span> <span class="k">if</span> <span class="n">is_list_like</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">5273</span>     <span class="n">com</span><span class="o">.</span><span class="n">require_length_match</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5274</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">sanitize_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5275</span> <span class="k">if</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">5276</span>     <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Index</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5277</span>     <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5280</span>     <span class="c1"># TODO: Remove kludge in sanitize_array for string mode when enforcing</span>
<span class="g g-Whitespace">   </span><span class="mi">5281</span>     <span class="c1"># this deprecation</span>

<span class="nn">File ~/Desktop/my-book-files/venv/lib64/python3.9/site-packages/pandas/core/common.py:573,</span> in <span class="ni">require_length_match</span><span class="nt">(data, index)</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span><span class="sd"> Check the length of data matches the length of the index.</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">573</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span>         <span class="s2">&quot;Length of values &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">575</span>         <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span>         <span class="s2">&quot;does not match length of index &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span>         <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span>     <span class="p">)</span>

<span class="ne">ValueError</span>: Length of values (6791) does not match length of index (102)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df_smiles</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6798
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_smiles</span> <span class="o">=</span> <span class="n">df_smiles</span><span class="p">[[</span><span class="s1">&#39;cid&#39;</span><span class="p">,</span><span class="s1">&#39;smiles&#39;</span><span class="p">]]</span>
<span class="n">df_smiles</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>smiles</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12850184</td>
      <td>C(C(=O)[C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O.C(...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>89753</td>
      <td>C([C@H]([C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O)O...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9403</td>
      <td>C[C@]12CC[C@H]3[C@H]([C@@H]1CC[C@@H]2OC(=O)CCC...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13218779</td>
      <td>C[C@@]12CC[C@@H](C1(C)C)C[C@H]2OC(=O)CSC#N</td>
    </tr>
    <tr>
      <th>4</th>
      <td>637566</td>
      <td>CC(=CCC/C(=C/CO)/C)C</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="generate-maccs-keys-from-smiles">
<h2>5. Generate MACCS keys from SMILES.<a class="headerlink" href="#generate-maccs-keys-from-smiles" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rdkit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Chem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit.Chem</span><span class="w"> </span><span class="kn">import</span> <span class="n">MACCSkeys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fps</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_smiles</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span> <span class="p">:</span>
    
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">smiles</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">mol</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t generate MOL object:&quot;</span><span class="p">,</span> <span class="s2">&quot;CID&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">smiles</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fps</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">MACCSkeys</span><span class="o">.</span><span class="n">GenMACCSKeys</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">ToBitString</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Can&#39;t generate MOL object: CID 28145 [NH4+].[NH4+].F[Si-2](F)(F)(F)(F)F
Can&#39;t generate MOL object: CID 28127 F[Si-2](F)(F)(F)(F)F.[Na+].[Na+]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate column names</span>
<span class="n">fpbitnames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">fpbitnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;cid&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">167</span><span class="p">):</span>   <span class="c1"># from MACCS000 to MACCS166</span>
    <span class="n">fpbitnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;maccs&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>

<span class="n">df_fps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">fps</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fpbitnames</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_fps</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>maccs000</th>
      <th>maccs001</th>
      <th>maccs002</th>
      <th>maccs003</th>
      <th>maccs004</th>
      <th>maccs005</th>
      <th>maccs006</th>
      <th>maccs007</th>
      <th>maccs008</th>
      <th>...</th>
      <th>maccs157</th>
      <th>maccs158</th>
      <th>maccs159</th>
      <th>maccs160</th>
      <th>maccs161</th>
      <th>maccs162</th>
      <th>maccs163</th>
      <th>maccs164</th>
      <th>maccs165</th>
      <th>maccs166</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12850184</th>
      <td>12850184</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>89753</th>
      <td>89753</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9403</th>
      <td>9403</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13218779</th>
      <td>13218779</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>637566</th>
      <td>637566</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 168 columns</p>
</div></div></div>
</div>
</section>
<section id="merge-activity-data-and-fingerprint-information">
<h2>6. Merge activity data and fingerprint information<a class="headerlink" href="#merge-activity-data-and-fingerprint-information" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_activity</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>activity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>12850184.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>89753.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>9403.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_fps</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>maccs000</th>
      <th>maccs001</th>
      <th>maccs002</th>
      <th>maccs003</th>
      <th>maccs004</th>
      <th>maccs005</th>
      <th>maccs006</th>
      <th>maccs007</th>
      <th>maccs008</th>
      <th>...</th>
      <th>maccs157</th>
      <th>maccs158</th>
      <th>maccs159</th>
      <th>maccs160</th>
      <th>maccs161</th>
      <th>maccs162</th>
      <th>maccs163</th>
      <th>maccs164</th>
      <th>maccs165</th>
      <th>maccs166</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12850184</th>
      <td>12850184</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>89753</th>
      <td>89753</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9403</th>
      <td>9403</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 168 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_data</span> <span class="o">=</span> <span class="n">df_activity</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_fps</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;cid&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;cid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In Section 5, there were two CIDs for which the MACCS keys could not be generated.  They need to be removed from <strong>df_data</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_data</span><span class="p">[</span><span class="n">df_data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>activity</th>
      <th>maccs000</th>
      <th>maccs001</th>
      <th>maccs002</th>
      <th>maccs003</th>
      <th>maccs004</th>
      <th>maccs005</th>
      <th>maccs006</th>
      <th>maccs007</th>
      <th>...</th>
      <th>maccs157</th>
      <th>maccs158</th>
      <th>maccs159</th>
      <th>maccs160</th>
      <th>maccs161</th>
      <th>maccs162</th>
      <th>maccs163</th>
      <th>maccs164</th>
      <th>maccs165</th>
      <th>maccs166</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2293</th>
      <td>28145.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9077</th>
      <td>28127.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 169 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_data</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6796
</pre></div>
</div>
</div>
</div>
<p>Save df_data in CSV for future use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;df_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="preparation-for-model-building">
<h2>7. Preparation for model building<a class="headerlink" href="#preparation-for-model-building" title="Link to this heading">#</a></h2>
</section>
<section id="loading-the-data-into-x-and-y">
<h2>7-(1) Loading the data into X and y.<a class="headerlink" href="#loading-the-data-into-x-and-y" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>activity</th>
      <th>maccs000</th>
      <th>maccs001</th>
      <th>maccs002</th>
      <th>maccs003</th>
      <th>maccs004</th>
      <th>maccs005</th>
      <th>maccs006</th>
      <th>maccs007</th>
      <th>...</th>
      <th>maccs157</th>
      <th>maccs158</th>
      <th>maccs159</th>
      <th>maccs160</th>
      <th>maccs161</th>
      <th>maccs162</th>
      <th>maccs163</th>
      <th>maccs164</th>
      <th>maccs165</th>
      <th>maccs166</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>12850184.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>89753.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>9403.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 169 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;activity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>maccs000</th>
      <th>maccs001</th>
      <th>maccs002</th>
      <th>maccs003</th>
      <th>maccs004</th>
      <th>maccs005</th>
      <th>maccs006</th>
      <th>maccs007</th>
      <th>maccs008</th>
      <th>maccs009</th>
      <th>...</th>
      <th>maccs157</th>
      <th>maccs158</th>
      <th>maccs159</th>
      <th>maccs160</th>
      <th>maccs161</th>
      <th>maccs162</th>
      <th>maccs163</th>
      <th>maccs164</th>
      <th>maccs165</th>
      <th>maccs166</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 167 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>    <span class="c1"># Number of all compounds</span>
<span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>          <span class="c1"># Number of actives</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6796
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>742
</pre></div>
</div>
</div>
</div>
</section>
<section id="remove-zero-variance-features">
<h2>7-(2) Remove zero-variance features<a class="headerlink" href="#remove-zero-variance-features" title="Link to this heading">#</a></h2>
<p>Some features in X are not helpful in distinguishing actives from inactives, because they are set ON for all compounds or OFF for all compounds.  Such features need to be removed because they would consume more computational resources without improving the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.feature_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">VarianceThreshold</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>  <span class="c1">#- Before removal</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6796, 167)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sel</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">()</span>
<span class="n">X</span><span class="o">=</span><span class="n">sel</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span>  <span class="c1">#- After removal</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6796, 163)
</pre></div>
</div>
</div>
</div>
<p>In this case, four features had zero variances.  Note that one of them is the first bit (maccs000) of the MACCS keys, which is added as a “dummy” to name each of bits 1~166 as maccs001, maccs002, … maccs166.</p>
</section>
<section id="train-test-split-a-9-1-ratio">
<h2>7-(3) Train-Test-Split (a 9:1 ratio)<a class="headerlink" href="#train-test-split-a-9-1-ratio" title="Link to this heading">#</a></h2>
<p>Now split the data set into a training set (90%) and test set (10%).  The training set will be used to train the model.  The developed model will be tested against the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> \
    <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">3100</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6116, 163) (680, 163) (6116,) (680,)
668 74
</pre></div>
</div>
</div>
</div>
</section>
<section id="balance-the-training-set-through-downsampling">
<h2>7-(4) Balance the training set through downsampling<a class="headerlink" href="#balance-the-training-set-through-downsampling" title="Link to this heading">#</a></h2>
<p>Check the dimension of the training data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6116
6116
163
</pre></div>
</div>
</div>
</div>
<p>Check the number of actives and inactives compound.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# inactives : &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# actives   : &quot;</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># inactives :  5448
# actives   :  668
</pre></div>
</div>
</div>
</div>
<p>The data set is highly imbalanced [the inactive to active ratio is 8.16 (=5448 / 668)].  To address this issue, let’s downsample the majority class (inactive compounds) to balance the data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Indicies of each class&#39; observations</span>
<span class="n">idx_inactives</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idx_actives</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">y_train</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Number of observations in each class</span>
<span class="n">num_inactives</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_inactives</span><span class="p">)</span>
<span class="n">num_actives</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_actives</span><span class="p">)</span>

<span class="c1"># Randomly sample from inactives without replacement</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">idx_inactives_downsampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">idx_inactives</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_actives</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Join together downsampled inactives with actives</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X_train</span><span class="p">[</span><span class="n">idx_inactives_downsampled</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[</span><span class="n">idx_actives</span><span class="p">]))</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx_inactives_downsampled</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">idx_actives</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>It is noteworthy that <strong>np.vstack</strong> is used for X_train and <strong>np.hstack</strong> is used for Y_train.  The direction of stacking is different because X_train is a 2-D array and y_train is a 1-D array.</p>
<p>Confirm that the downsampled data set has the correct dimension and active/inactive counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# inactives : &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# actives   : &quot;</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># inactives :  668
# actives   :  668
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1336
1336
163
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="build-a-model-using-the-training-set">
<h1><span class="section-number">9. </span>8. Build a model using the training set.<a class="headerlink" href="#build-a-model-using-the-training-set" title="Link to this heading">#</a></h1>
<p>Now we are ready to build predictive models using machine learning algorithms available in the scikit-learn library (<a class="reference external" href="https://scikit-learn.org/">https://scikit-learn.org/</a>).  This notebook will use Naive Bayes and decisiont tree, because they are relatively fast and simple.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.naive_bayes</span><span class="w"> </span><span class="kn">import</span> <span class="n">BernoulliNB</span>        <span class="c1">#-- Naive Bayes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.tree</span><span class="w"> </span><span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>    <span class="c1">#-- Decision Tree</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">confusion_matrix</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">roc_auc_score</span>
</pre></div>
</div>
</div>
</div>
<section id="naive-bayes">
<h2>8-(1) Naive Bayes<a class="headerlink" href="#naive-bayes" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span> <span class="o">=</span> <span class="n">BernoulliNB</span><span class="p">()</span>            <span class="c1"># set up the NB classification model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">,</span><span class="n">y_train</span> <span class="p">)</span>    <span class="c1"># Train the model by fitting it to the data.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BernoulliNB(alpha=1.0, binarize=0.0, class_prior=None, fit_prior=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">)</span>    <span class="c1"># Apply the model to predict the training compound&#39;s activity.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CMat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>    <span class="c1">#-- generate confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CMat</span><span class="p">)</span>    <span class="c1"># [[TN, FP], </span>
               <span class="c1">#  [FN, TP]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[462 206]
 [199 469]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>

<span class="n">sens</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>    <span class="c1"># TP / (FN + TP)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>    <span class="c1"># TN / (TN + FP )</span>
<span class="n">bacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">sens</span> <span class="o">+</span> <span class="n">spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">y_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Accuracy          = &quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Balanced Accuracy = &quot;</span><span class="p">,</span> <span class="n">bacc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Sensitivity       = &quot;</span><span class="p">,</span> <span class="n">sens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Specificity       = &quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- AUC-ROC           = &quot;</span><span class="p">,</span> <span class="n">auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#-- Accuracy          =  0.6968562874251497
#-- Balanced Accuracy =  0.6968562874251496
#-- Sensitivity       =  0.7020958083832335
#-- Specificity       =  0.6916167664670658
#-- AUC-ROC           =  0.7496985818781599
</pre></div>
</div>
</div>
</div>
<p>When applied to predict the activity of the training compounds, the NB classifier resulted in the accuracy of 0.70 and AUC-ROC of 0.75.  However, the real performance of the model should be evaluated with the test set data, which are not used for model training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>    <span class="c1">#-- Apply the model to predict the test set compounds&#39; activity.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CMat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>    <span class="c1">#-- generate confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CMat</span><span class="p">)</span>    <span class="c1"># [[TN, FP], </span>
               <span class="c1">#  [FN, TP]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[412 194]
 [ 28  46]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>

<span class="n">sens</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">bacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">sens</span> <span class="o">+</span> <span class="n">spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">y_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span> <span class="n">X_test</span> <span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Accuracy          = &quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Balanced Accuracy = &quot;</span><span class="p">,</span> <span class="n">bacc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Sensitivity       = &quot;</span><span class="p">,</span> <span class="n">sens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Specificity       = &quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- AUC-ROC           = &quot;</span><span class="p">,</span> <span class="n">auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#-- Accuracy          =  0.6735294117647059
#-- Balanced Accuracy =  0.6507448042101507
#-- Sensitivity       =  0.6216216216216216
#-- Specificity       =  0.6798679867986799
#-- AUC-ROC           =  0.724099099099099
</pre></div>
</div>
</div>
</div>
<p>For the test set, the accuracy is 0.67 and the AUC-ROC is 0.72.  These values are somewhat smaller (by 0.03) than those for the training set.  Also note that the accuracy is no longer the same as the balanced accruacy (which is the average of the sensitivity and specificity).</p>
<p>Some additional performance information may be obtained using <strong>classification_report()</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              precision    recall  f1-score   support

           0       0.94      0.68      0.79       606
           1       0.19      0.62      0.29        74

    accuracy                           0.67       680
   macro avg       0.56      0.65      0.54       680
weighted avg       0.86      0.67      0.73       680
</pre></div>
</div>
</div>
</div>
</section>
<section id="decision-tree">
<h2>8-(2) Decision Tree<a class="headerlink" href="#decision-tree" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>    <span class="c1"># set up the DT classification model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">,</span><span class="n">y_train</span> <span class="p">)</span>    <span class="c1"># Train the model by fitting it to the data (using the default values for all parameters)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DecisionTreeClassifier(class_weight=None, criterion=&#39;gini&#39;, max_depth=None,
                       max_features=None, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, presort=False,
                       random_state=0, splitter=&#39;best&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">)</span>    <span class="c1"># Apply the model to predict the training compound&#39;s activity.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CMat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>    <span class="c1">#-- generate confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CMat</span><span class="p">)</span>    <span class="c1"># [[TN, FP], </span>
               <span class="c1">#  [FN, TP]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[663   5]
 [  3 665]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>

<span class="n">sens</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>    <span class="c1"># TP / (FN + TP)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>    <span class="c1"># TN / (TN + FP )</span>
<span class="n">bacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">sens</span> <span class="o">+</span> <span class="n">spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">y_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Accuracy          = &quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Balanced Accuracy = &quot;</span><span class="p">,</span> <span class="n">bacc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Sensitivity       = &quot;</span><span class="p">,</span> <span class="n">sens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Specificity       = &quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- AUC-ROC           = &quot;</span><span class="p">,</span> <span class="n">auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#-- Accuracy          =  0.9940119760479041
#-- Balanced Accuracy =  0.9940119760479043
#-- Sensitivity       =  0.9955089820359282
#-- Specificity       =  0.9925149700598802
#-- AUC-ROC           =  0.9998890691670551
</pre></div>
</div>
</div>
</div>
<p>When applied to predict the activity of the <strong>training</strong> compounds, the DT classifier resulted in very high scores (&gt;0.99) for all five performance measures considered here.  However, it does <strong>not</strong> necessarily mean that the model will perform very well for the <strong>test</strong> set compounds.  Let’s apply the model to the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>    <span class="c1">#-- Apply the model to predict the test set compounds&#39; activity.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CMat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>    <span class="c1">#-- generate confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CMat</span><span class="p">)</span>    <span class="c1"># [[TN, FP], </span>
               <span class="c1">#  [FN, TP]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[422 184]
 [ 32  42]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>

<span class="n">sens</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">bacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">sens</span> <span class="o">+</span> <span class="n">spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">y_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span> <span class="n">X_test</span> <span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Accuracy          = &quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Balanced Accuracy = &quot;</span><span class="p">,</span> <span class="n">bacc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Sensitivity       = &quot;</span><span class="p">,</span> <span class="n">sens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Specificity       = &quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- AUC-ROC           = &quot;</span><span class="p">,</span> <span class="n">auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#-- Accuracy          =  0.6823529411764706
#-- Balanced Accuracy =  0.6319686022656319
#-- Sensitivity       =  0.5675675675675675
#-- Specificity       =  0.6963696369636964
#-- AUC-ROC           =  0.6298724467041299
</pre></div>
</div>
</div>
</div>
<p>When the DT model was applied to the test set, all performance measures were much worse than those for the training set.  This is a typical example of <strong>outfitting</strong>.</p>
</section>
<section id="model-building-through-cross-validation">
<h2>9. Model building through cross-validation<a class="headerlink" href="#model-building-through-cross-validation" title="Link to this heading">#</a></h2>
<p>In the above section, the models were developed using the default values for many optional hyperparamters, which cannot be learned by the training algorithm.  For example, when building a decision tree model, one should specify how the tree should be deep, how many compounds should be allowed in a single leaf, what is the minimum number of compounds in a single leaf, etc.</p>
<p>The cells below demonstrate how to perform hyperparameter optimization through 10-fold cross-validation.  In this example, five values for each of three hyperparameters used in decision tree are considered (max_depth, min_samples_split, and min_samples_leaf), resulting in a total of 125 combination of the parameter values (=5 x 5 x 5).  For each combination, 10 models are generated (through 10-fold cross validation) and the average performance will be tracked.  The goal is to find the parameter value combination that results in the highest average performance score (e.g., ‘roc_auc’) from the 10-fold cross validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSearchCV</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="s1">&#39;balanced_accuracy&#39;</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ncvs</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">max_depth_range</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span> <span class="p">)</span>
<span class="n">min_samples_split_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span> <span class="p">)</span>
<span class="n">min_samples_leaf_range</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span> <span class="p">)</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_range</span><span class="p">,</span>
                   <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_range</span><span class="p">,</span>
                   <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_range</span> <span class="p">)</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span> <span class="p">),</span>
                    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ncvs</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span>
                    <span class="n">return_train_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">iid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameter set&quot;</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best parameter set {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 3}
</pre></div>
</div>
</div>
</div>
<p>If necessary, it is possible to look into the performance data for each parameter value combination (stored in <strong>clf.cv_results_</strong>), as shown in the following cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">means_1a</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_train_roc_auc&#39;</span><span class="p">]</span>
<span class="n">stds_1a</span>  <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;std_train_roc_auc&#39;</span><span class="p">]</span>

<span class="n">means_1b</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_test_roc_auc&#39;</span><span class="p">]</span>
<span class="n">stds_1b</span>  <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;std_test_roc_auc&#39;</span><span class="p">]</span>

<span class="n">means_2a</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_train_balanced_accuracy&#39;</span><span class="p">]</span>
<span class="n">stds_2a</span>  <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;std_train_balanced_accuracy&#39;</span><span class="p">]</span>

<span class="n">means_2b</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_test_balanced_accuracy&#39;</span><span class="p">]</span>
<span class="n">stds_2b</span>  <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;std_test_balanced_accuracy&#39;</span><span class="p">]</span>

<span class="n">iterobjs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">means_1a</span><span class="p">,</span> <span class="n">stds_1a</span><span class="p">,</span> <span class="n">means_1b</span><span class="p">,</span> <span class="n">stds_1b</span><span class="p">,</span>
                <span class="n">means_2a</span><span class="p">,</span> <span class="n">stds_2a</span><span class="p">,</span> <span class="n">means_2b</span><span class="p">,</span> <span class="n">stds_2b</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="k">for</span> <span class="n">m1a</span><span class="p">,</span> <span class="n">s1a</span><span class="p">,</span> <span class="n">m1b</span><span class="p">,</span> <span class="n">s1b</span><span class="p">,</span> <span class="n">m2a</span><span class="p">,</span> <span class="n">s2a</span><span class="p">,</span> <span class="n">m2b</span><span class="p">,</span> <span class="n">s2b</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">iterobjs</span> <span class="p">:</span>

    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Grid </span><span class="si">%r</span><span class="s2"> : </span><span class="si">%0.4f</span><span class="s2"> </span><span class="si">%0.04f</span><span class="s2"> </span><span class="si">%0.4f</span><span class="s2"> </span><span class="si">%0.04f</span><span class="s2"> </span><span class="si">%0.4f</span><span class="s2"> </span><span class="si">%0.04f</span><span class="s2"> </span><span class="si">%0.4f</span><span class="s2"> </span><span class="si">%0.04f</span><span class="s2">&quot;</span>
           <span class="o">%</span> <span class="p">(</span> <span class="n">params</span><span class="p">,</span> <span class="n">m1a</span><span class="p">,</span> <span class="n">s1a</span><span class="p">,</span> <span class="n">m1b</span><span class="p">,</span> <span class="n">s1b</span><span class="p">,</span> <span class="n">m2a</span><span class="p">,</span> <span class="n">s2a</span><span class="p">,</span> <span class="n">m2b</span><span class="p">,</span> <span class="n">s2b</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 3} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 4} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 5} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 6} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 7} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 3} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 4} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 5} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 6} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 7} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 3} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 4} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 5} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 6} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 7} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 3} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 4} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 5} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 6} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 7} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 3} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 4} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 5} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 6} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 3, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 7} : 0.7714 0.0042 0.7542 0.0420 0.7264 0.0052 0.7019 0.0370
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 3} : 0.8051 0.0053 0.7630 0.0501 0.7556 0.0075 0.7244 0.0376
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 4} : 0.8051 0.0053 0.7630 0.0501 0.7556 0.0075 0.7244 0.0376
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 5} : 0.8051 0.0053 0.7630 0.0501 0.7556 0.0075 0.7244 0.0376
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 6} : 0.8051 0.0053 0.7630 0.0501 0.7556 0.0075 0.7244 0.0376
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 7} : 0.8051 0.0053 0.7630 0.0501 0.7556 0.0075 0.7244 0.0376
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 3} : 0.8051 0.0054 0.7603 0.0516 0.7554 0.0073 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 4} : 0.8051 0.0054 0.7603 0.0516 0.7554 0.0073 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 5} : 0.8051 0.0054 0.7603 0.0516 0.7554 0.0073 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 6} : 0.8051 0.0054 0.7603 0.0516 0.7554 0.0073 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 7} : 0.8051 0.0054 0.7603 0.0516 0.7554 0.0073 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 3} : 0.8042 0.0056 0.7586 0.0506 0.7544 0.0074 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 4} : 0.8042 0.0056 0.7586 0.0506 0.7544 0.0074 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 5} : 0.8042 0.0056 0.7586 0.0506 0.7544 0.0074 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 6} : 0.8042 0.0056 0.7586 0.0506 0.7544 0.0074 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 7} : 0.8042 0.0056 0.7586 0.0506 0.7544 0.0074 0.7237 0.0386
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 3} : 0.8043 0.0056 0.7592 0.0494 0.7528 0.0069 0.7229 0.0401
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 4} : 0.8043 0.0056 0.7592 0.0494 0.7528 0.0069 0.7229 0.0401
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 5} : 0.8043 0.0056 0.7592 0.0494 0.7528 0.0069 0.7229 0.0401
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 6} : 0.8043 0.0056 0.7592 0.0494 0.7528 0.0069 0.7229 0.0401
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 7} : 0.8043 0.0056 0.7592 0.0494 0.7528 0.0069 0.7229 0.0401
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 3} : 0.8041 0.0055 0.7573 0.0511 0.7527 0.0068 0.7214 0.0421
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 4} : 0.8041 0.0055 0.7573 0.0511 0.7527 0.0068 0.7214 0.0421
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 5} : 0.8041 0.0055 0.7573 0.0511 0.7527 0.0068 0.7214 0.0421
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 6} : 0.8041 0.0055 0.7573 0.0511 0.7527 0.0068 0.7214 0.0421
Grid {&#39;max_depth&#39;: 4, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 7} : 0.8041 0.0055 0.7573 0.0511 0.7527 0.0068 0.7214 0.0421
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 3} : 0.8389 0.0049 0.7560 0.0416 0.7794 0.0073 0.7139 0.0439
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 4} : 0.8389 0.0049 0.7560 0.0416 0.7794 0.0073 0.7139 0.0439
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 5} : 0.8389 0.0049 0.7560 0.0416 0.7794 0.0073 0.7139 0.0439
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 6} : 0.8387 0.0051 0.7567 0.0421 0.7793 0.0075 0.7139 0.0439
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 7} : 0.8385 0.0050 0.7567 0.0421 0.7793 0.0075 0.7139 0.0439
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 3} : 0.8380 0.0049 0.7595 0.0429 0.7782 0.0076 0.7139 0.0452
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 4} : 0.8380 0.0049 0.7595 0.0429 0.7782 0.0076 0.7139 0.0452
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 5} : 0.8380 0.0049 0.7595 0.0429 0.7782 0.0076 0.7139 0.0452
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 6} : 0.8380 0.0049 0.7595 0.0429 0.7782 0.0076 0.7139 0.0452
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 7} : 0.8379 0.0049 0.7595 0.0429 0.7782 0.0076 0.7139 0.0452
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 3} : 0.8368 0.0059 0.7631 0.0381 0.7759 0.0078 0.7139 0.0461
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 4} : 0.8368 0.0059 0.7631 0.0381 0.7759 0.0078 0.7139 0.0461
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 5} : 0.8368 0.0059 0.7631 0.0381 0.7759 0.0078 0.7139 0.0461
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 6} : 0.8368 0.0059 0.7631 0.0381 0.7759 0.0078 0.7139 0.0461
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 7} : 0.8368 0.0059 0.7631 0.0381 0.7759 0.0078 0.7139 0.0461
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 3} : 0.8383 0.0064 0.7593 0.0398 0.7760 0.0078 0.7102 0.0481
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 4} : 0.8383 0.0064 0.7593 0.0398 0.7760 0.0078 0.7102 0.0481
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 5} : 0.8383 0.0064 0.7593 0.0398 0.7760 0.0078 0.7102 0.0481
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 6} : 0.8383 0.0064 0.7593 0.0398 0.7760 0.0078 0.7102 0.0481
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 7} : 0.8383 0.0064 0.7593 0.0398 0.7760 0.0078 0.7102 0.0481
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 3} : 0.8376 0.0060 0.7523 0.0444 0.7756 0.0075 0.7056 0.0499
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 4} : 0.8376 0.0060 0.7523 0.0444 0.7756 0.0075 0.7056 0.0499
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 5} : 0.8376 0.0060 0.7523 0.0444 0.7756 0.0075 0.7056 0.0499
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 6} : 0.8376 0.0060 0.7523 0.0444 0.7756 0.0075 0.7056 0.0499
Grid {&#39;max_depth&#39;: 5, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 7} : 0.8376 0.0060 0.7523 0.0444 0.7756 0.0075 0.7056 0.0499
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 3} : 0.8749 0.0061 0.7356 0.0463 0.8009 0.0072 0.7042 0.0378
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 4} : 0.8749 0.0061 0.7356 0.0463 0.8009 0.0072 0.7042 0.0378
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 5} : 0.8749 0.0062 0.7356 0.0463 0.8009 0.0072 0.7042 0.0378
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 6} : 0.8748 0.0062 0.7351 0.0465 0.8010 0.0072 0.7027 0.0379
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 7} : 0.8740 0.0057 0.7370 0.0450 0.8002 0.0068 0.7042 0.0398
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 3} : 0.8723 0.0057 0.7383 0.0549 0.7976 0.0070 0.7005 0.0413
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 4} : 0.8723 0.0057 0.7383 0.0549 0.7976 0.0070 0.7005 0.0413
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 5} : 0.8723 0.0057 0.7383 0.0549 0.7976 0.0070 0.7005 0.0413
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 6} : 0.8723 0.0057 0.7383 0.0549 0.7976 0.0070 0.7005 0.0413
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 7} : 0.8719 0.0058 0.7333 0.0477 0.7974 0.0070 0.6967 0.0364
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 3} : 0.8697 0.0065 0.7397 0.0496 0.7947 0.0067 0.6989 0.0506
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 4} : 0.8697 0.0065 0.7397 0.0496 0.7947 0.0067 0.6989 0.0506
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 5} : 0.8697 0.0065 0.7397 0.0496 0.7947 0.0067 0.6989 0.0506
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 6} : 0.8697 0.0065 0.7397 0.0496 0.7947 0.0067 0.6989 0.0506
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 7} : 0.8697 0.0065 0.7397 0.0496 0.7947 0.0067 0.6989 0.0506
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 3} : 0.8682 0.0063 0.7396 0.0522 0.7940 0.0079 0.6989 0.0547
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 4} : 0.8682 0.0063 0.7396 0.0522 0.7940 0.0079 0.6989 0.0547
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 5} : 0.8682 0.0063 0.7396 0.0522 0.7940 0.0079 0.6989 0.0547
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 6} : 0.8682 0.0063 0.7396 0.0522 0.7940 0.0079 0.6989 0.0547
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 7} : 0.8682 0.0063 0.7396 0.0522 0.7940 0.0079 0.6989 0.0547
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 3} : 0.8661 0.0057 0.7392 0.0464 0.7921 0.0071 0.6974 0.0494
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 4} : 0.8661 0.0057 0.7392 0.0464 0.7921 0.0071 0.6974 0.0494
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 5} : 0.8661 0.0057 0.7392 0.0464 0.7921 0.0071 0.6974 0.0494
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 6} : 0.8661 0.0057 0.7392 0.0464 0.7921 0.0071 0.6974 0.0494
Grid {&#39;max_depth&#39;: 6, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 7} : 0.8661 0.0057 0.7392 0.0464 0.7921 0.0071 0.6974 0.0494
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 3} : 0.9050 0.0072 0.7264 0.0549 0.8281 0.0087 0.6878 0.0467
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 4} : 0.9050 0.0072 0.7264 0.0549 0.8281 0.0087 0.6878 0.0467
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 5} : 0.9044 0.0072 0.7225 0.0545 0.8273 0.0085 0.6848 0.0468
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 6} : 0.9041 0.0071 0.7202 0.0498 0.8273 0.0087 0.6818 0.0469
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 2, &#39;min_samples_split&#39;: 7} : 0.9018 0.0068 0.7276 0.0555 0.8248 0.0080 0.6833 0.0456
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 3} : 0.9007 0.0063 0.7261 0.0571 0.8231 0.0071 0.6818 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 4} : 0.9007 0.0063 0.7261 0.0571 0.8231 0.0071 0.6818 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 5} : 0.9007 0.0063 0.7261 0.0571 0.8231 0.0071 0.6818 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 6} : 0.9007 0.0063 0.7261 0.0571 0.8231 0.0071 0.6818 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 3, &#39;min_samples_split&#39;: 7} : 0.8992 0.0065 0.7292 0.0561 0.8214 0.0077 0.6841 0.0478
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 3} : 0.8949 0.0074 0.7423 0.0598 0.8144 0.0083 0.6937 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 4} : 0.8949 0.0074 0.7423 0.0598 0.8144 0.0083 0.6937 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 5} : 0.8949 0.0074 0.7423 0.0598 0.8144 0.0083 0.6937 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 6} : 0.8949 0.0074 0.7423 0.0598 0.8144 0.0083 0.6937 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 4, &#39;min_samples_split&#39;: 7} : 0.8949 0.0074 0.7423 0.0598 0.8144 0.0083 0.6937 0.0460
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 3} : 0.8921 0.0075 0.7416 0.0565 0.8116 0.0074 0.6878 0.0483
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 4} : 0.8921 0.0075 0.7416 0.0565 0.8116 0.0074 0.6878 0.0483
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 5} : 0.8921 0.0075 0.7416 0.0565 0.8116 0.0074 0.6878 0.0483
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 6} : 0.8921 0.0075 0.7416 0.0565 0.8116 0.0074 0.6878 0.0483
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 5, &#39;min_samples_split&#39;: 7} : 0.8921 0.0075 0.7416 0.0565 0.8116 0.0074 0.6878 0.0483
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 3} : 0.8873 0.0072 0.7375 0.0524 0.8068 0.0064 0.6855 0.0413
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 4} : 0.8873 0.0072 0.7375 0.0524 0.8068 0.0064 0.6855 0.0413
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 5} : 0.8873 0.0072 0.7375 0.0524 0.8068 0.0064 0.6855 0.0413
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 6} : 0.8873 0.0072 0.7375 0.0524 0.8068 0.0064 0.6855 0.0413
Grid {&#39;max_depth&#39;: 7, &#39;min_samples_leaf&#39;: 6, &#39;min_samples_split&#39;: 7} : 0.8873 0.0072 0.7375 0.0524 0.8068 0.0064 0.6855 0.0413
</pre></div>
</div>
</div>
</div>
<p>Uncomment the following cell to look into additional performance data stored in cv_result_.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#print(clf.cv_result_)</span>
</pre></div>
</div>
</div>
</div>
<p>It is important to understand that each model built through 10-fold cross-validation during hyperparameter optimization uses only 90% of the compounds in the training set and the remaining 10% is used for testing that model.  After all parameter value combinations are evaluated, the best parameter values are selected and used to rebuild a model from <strong>all</strong> compounds in the training set.  <strong>GridSearchCV()</strong> takes care of this last step automatically.  Therefore, there is no need to take an extra step to build a model using <strong>cls.fit()</strong> after hyperparameter optimization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">)</span>    <span class="c1"># Apply the model to predict the training compound&#39;s activity.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CMat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>    <span class="c1">#-- generate confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CMat</span><span class="p">)</span>    <span class="c1"># [[TN, FP], </span>
               <span class="c1">#  [FN, TP]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[543 125]
 [179 489]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>

<span class="n">sens</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>    <span class="c1"># TP / (FN + TP)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>    <span class="c1"># TN / (TN + FP )</span>
<span class="n">bacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">sens</span> <span class="o">+</span> <span class="n">spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">y_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Accuracy          = &quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Balanced Accuracy = &quot;</span><span class="p">,</span> <span class="n">bacc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Sensitivity       = &quot;</span><span class="p">,</span> <span class="n">sens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Specificity       = &quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- AUC-ROC           = &quot;</span><span class="p">,</span> <span class="n">auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#-- Accuracy          =  0.7724550898203593
#-- Balanced Accuracy =  0.7724550898203593
#-- Sensitivity       =  0.7320359281437125
#-- Specificity       =  0.812874251497006
#-- AUC-ROC           =  0.8336452095808383
</pre></div>
</div>
</div>
</div>
<p>Compare these performance data with those from section 8-(2) (for the training set).  When the default values were used, the DT model gave &gt;0.99 for all performance measures, but the current models (developed using hyperparameter optimization) have much lower values, ranging from 0.73 to 0.83.  Again, however, what really matters is the performance against the test set, which contains the data not used for model training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>    <span class="c1">#-- Apply the model to predict the test set compounds&#39; activity.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CMat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>    <span class="c1">#-- generate confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CMat</span><span class="p">)</span>    <span class="c1"># [[TN, FP], </span>
               <span class="c1">#  [FN, TP]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[457 149]
 [ 26  48]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>

<span class="n">sens</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">bacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">sens</span> <span class="o">+</span> <span class="n">spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">y_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span> <span class="n">X_test</span> <span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Accuracy          = &quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Balanced Accuracy = &quot;</span><span class="p">,</span> <span class="n">bacc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Sensitivity       = &quot;</span><span class="p">,</span> <span class="n">sens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Specificity       = &quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- AUC-ROC           = &quot;</span><span class="p">,</span> <span class="n">auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#-- Accuracy          =  0.7426470588235294
#-- Balanced Accuracy =  0.7013870305949514
#-- Sensitivity       =  0.6486486486486487
#-- Specificity       =  0.7541254125412541
#-- AUC-ROC           =  0.7496209080367496
</pre></div>
</div>
</div>
</div>
<p>Now we can see that the model from hyperparameter optimization gives better performance data against the test set, compared to the model developed using the default parameter values.  Importantly, the model from hyperparameter optimization shows smaller differences in performance measures between the training and test sets, indicatiing that the issue of outffiting has been alleviated substantially.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercises">
<h1><span class="section-number">10. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h1>
<p>In this assignment, we will build predictive models using the same aromatase data.</p>
<p><strong>step 1</strong> Show the following information to make sure that the activity data in the <strong>df_activity</strong> data frame is still available.</p>
<ul class="simple">
<li><p>The first five lines of <strong>df_activity</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="n">df_activity</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>activity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>12850184.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>89753.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>9403.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>13218779.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>637566.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The counts of active/inactive compounds in <strong>df_activity</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="n">df_activity</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
    </tr>
    <tr>
      <th>activity</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6056</td>
    </tr>
    <tr>
      <th>1</th>
      <td>742</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Step 2</strong> Show the following information to make sure the structure data is still available.</p>
<ul class="simple">
<li><p>The first five lines of <strong>df_smiles</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="n">df_smiles</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>smiles</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12850184</td>
      <td>C(C(=O)[C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O.C(...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>89753</td>
      <td>C([C@H]([C@H]([C@@H]([C@H](C(=O)[O-])O)O)O)O)O...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9403</td>
      <td>C[C@]12CC[C@H]3[C@H]([C@@H]1CC[C@@H]2OC(=O)CCC...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13218779</td>
      <td>C[C@@]12CC[C@@H](C1(C)C)C[C@H]2OC(=O)CSC#N</td>
    </tr>
    <tr>
      <th>4</th>
      <td>637566</td>
      <td>CC(=CCC/C(=C/CO)/C)C</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>the number of rows of <strong>df_smiles</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="nb">len</span><span class="p">(</span><span class="n">df_smiles</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6798
</pre></div>
</div>
</div>
</div>
<p><strong>Step 3</strong> Generate the (ECFP-equivalent) circular fingerprints from the SMILES strings.</p>
<ul class="simple">
<li><p>Use RDKit to generate 1024-bit-long circular fingerprints.</p></li>
<li><p>Set the radius of the circular fingerprint to 2.</p></li>
<li><p>Store the fingerprints in a data_frame called <strong>df_fps</strong> (along with the CIDs).</p></li>
<li><p>Print the dimension of <strong>df_fps</strong>.</p></li>
<li><p>Show the first five lines of <strong>df_fps</strong>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">rdkit.Chem</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllChem</span>

<span class="n">fps</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_smiles</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span> <span class="p">:</span>
    
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">smiles</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">mol</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t generate MOL object:&quot;</span><span class="p">,</span> <span class="s2">&quot;CID&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">smiles</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fps</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprintAsBitVect</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nBits</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">ToBitString</span><span class="p">())</span>
        
<span class="c1"># Generate column names</span>
<span class="n">fpbitnames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">fpbitnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;cid&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1024</span><span class="p">):</span>   <span class="c1"># from MACCS000 to MACCS166</span>
    <span class="n">fpbitnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;ecfp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>

<span class="n">df_fps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">fps</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fpbitnames</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_fps</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">df_fps</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Can&#39;t generate MOL object: CID 28145 [NH4+].[NH4+].F[Si-2](F)(F)(F)(F)F
Can&#39;t generate MOL object: CID 28127 F[Si-2](F)(F)(F)(F)F.[Na+].[Na+]
(6796, 1025)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>ecfp000</th>
      <th>ecfp001</th>
      <th>ecfp002</th>
      <th>ecfp003</th>
      <th>ecfp004</th>
      <th>ecfp005</th>
      <th>ecfp006</th>
      <th>ecfp007</th>
      <th>ecfp008</th>
      <th>...</th>
      <th>ecfp1014</th>
      <th>ecfp1015</th>
      <th>ecfp1016</th>
      <th>ecfp1017</th>
      <th>ecfp1018</th>
      <th>ecfp1019</th>
      <th>ecfp1020</th>
      <th>ecfp1021</th>
      <th>ecfp1022</th>
      <th>ecfp1023</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12850184</th>
      <td>12850184</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>89753</th>
      <td>89753</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9403</th>
      <td>9403</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13218779</th>
      <td>13218779</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>637566</th>
      <td>637566</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 1025 columns</p>
</div></div></div>
</div>
<p><strong>Step 4</strong> Merge the <strong>df_activity</strong> and <strong>df_fps</strong> data frames into a data frame called <strong>df_data</strong></p>
<ul class="simple">
<li><p>Join the two data frames using the CID column as keys.</p></li>
<li><p>Remove the rows that have any NULL values (i.e., compounds for which the fingerprints couldn’t be generated).</p></li>
<li><p>Print the dimension of <strong>df_data</strong>.</p></li>
<li><p>Show the first five lines of <strong>df_data</strong>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="n">df_data</span> <span class="o">=</span> <span class="n">df_activity</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_fps</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;cid&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;cid&#39;</span><span class="p">)</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6796, 1026)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cid</th>
      <th>activity</th>
      <th>ecfp000</th>
      <th>ecfp001</th>
      <th>ecfp002</th>
      <th>ecfp003</th>
      <th>ecfp004</th>
      <th>ecfp005</th>
      <th>ecfp006</th>
      <th>ecfp007</th>
      <th>...</th>
      <th>ecfp1014</th>
      <th>ecfp1015</th>
      <th>ecfp1016</th>
      <th>ecfp1017</th>
      <th>ecfp1018</th>
      <th>ecfp1019</th>
      <th>ecfp1020</th>
      <th>ecfp1021</th>
      <th>ecfp1022</th>
      <th>ecfp1023</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>12850184.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>89753.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>9403.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>13218779.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>637566.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 1026 columns</p>
</div></div></div>
</div>
<p><strong>Step 5</strong> Prepare input and output data for model building</p>
<ul class="simple">
<li><p>Load the fingerprint data into 2-D array (X) and the activity data into 1-D array (y).</p></li>
<li><p>Show the dimension of X and y.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;activity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6796, 1024)
6796
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Remove zero-variance features from X (if any).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="n">sel</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">()</span>
<span class="n">X</span><span class="o">=</span><span class="n">sel</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span>  <span class="c1">#-- dimension after removal (none removed)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6796, 1024)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Split the data set into training and test sets (90% vs 10%) (using random_state=3100).</p></li>
<li><p>Print the dimension of X and y for the training and test sets.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> \
    <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">3100</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6116, 1024) (680, 1024) (6116,) (680,)
668 74
6116
6116
1024
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Balance the training data set through downsampling.</p></li>
<li><p>Show the number of inactive/active compounds in the downsampled training set.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="c1"># Indicies of each class&#39; observations</span>
<span class="n">idx_inactives</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idx_actives</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">y_train</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_inactives</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_actives</span><span class="p">))</span>

<span class="c1"># Number of observations in each class</span>
<span class="n">num_inactives</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_inactives</span><span class="p">)</span>
<span class="n">num_actives</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_actives</span><span class="p">)</span>

<span class="c1"># Randomly sample from inactives without replacement</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">idx_inactives_downsampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">idx_inactives</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_actives</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Join together downsampled inactives with actives</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X_train</span><span class="p">[</span><span class="n">idx_inactives_downsampled</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[</span><span class="n">idx_actives</span><span class="p">]))</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx_inactives_downsampled</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">idx_actives</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# inactives : &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# actives   : &quot;</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5448 668
# inactives :  668
# actives   :  668
</pre></div>
</div>
</div>
</div>
<p><strong>Step 6</strong> Building a Random Forest model using the balanced training data set.</p>
<ul class="simple">
<li><p>First read the followng documents about random forest (<a class="reference external" href="https://scikit-learn.org/stable/modules/ensemble.html#forest">https://scikit-learn.org/stable/modules/ensemble.html#forest</a> and <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html#sklearn.ensemble.RandomForestClassifier">https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html#sklearn.ensemble.RandomForestClassifier</a>).</p></li>
<li><p>Use 10-fold cross validation to select the best value for the “n_estimators” parameter that maximizes the <strong>balanced accuracy</strong>.  Test 40 values from 5 to 200 with an increment of 5 (e.g., 5, 10, 15, 20, …, 190, 195, 200).</p></li>
<li><p>For parameters ‘max_depth’, ‘min_samples_leaf’, and ‘min_samples_split’, use the best values found in Section 9.</p></li>
<li><p>For other parameters, use the default values.</p></li>
<li><p>For each parameter value, print the mean balanced accuracies (for both training and test from cross validation).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="n">ncvs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">]</span>

<span class="n">n_estimators_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span> <span class="p">);</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_range</span> <span class="p">);</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span> <span class="n">RandomForestClassifier</span><span class="p">(</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ncvs</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="s1">&#39;balanced_accuracy&#39;</span><span class="p">,</span>
                    <span class="n">return_train_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">iid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Best parameter set&quot;</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>

<span class="n">means_1a</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_train_balanced_accuracy&#39;</span><span class="p">]</span>
<span class="n">means_1b</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_test_balanced_accuracy&#39;</span><span class="p">]</span>

<span class="n">iterobjs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">means_1a</span><span class="p">,</span> <span class="n">means_1b</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="k">for</span> <span class="n">m1a</span><span class="p">,</span> <span class="n">m1b</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">iterobjs</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Grid </span><span class="si">%r</span><span class="s2"> : </span><span class="si">%0.4f</span><span class="s2"> </span><span class="si">%0.04f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">params</span><span class="p">,</span> <span class="n">m1a</span><span class="p">,</span> <span class="n">m1b</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#-- Best parameter set {&#39;n_estimators&#39;: 100}
Grid {&#39;n_estimators&#39;: 5} : 0.6801 0.6287
Grid {&#39;n_estimators&#39;: 10} : 0.7236 0.6639
Grid {&#39;n_estimators&#39;: 15} : 0.7388 0.6804
Grid {&#39;n_estimators&#39;: 20} : 0.7512 0.6879
Grid {&#39;n_estimators&#39;: 25} : 0.7542 0.6856
Grid {&#39;n_estimators&#39;: 30} : 0.7571 0.6803
Grid {&#39;n_estimators&#39;: 35} : 0.7616 0.6819
Grid {&#39;n_estimators&#39;: 40} : 0.7596 0.6871
Grid {&#39;n_estimators&#39;: 45} : 0.7586 0.6916
Grid {&#39;n_estimators&#39;: 50} : 0.7621 0.6893
Grid {&#39;n_estimators&#39;: 55} : 0.7663 0.6886
Grid {&#39;n_estimators&#39;: 60} : 0.7651 0.6901
Grid {&#39;n_estimators&#39;: 65} : 0.7669 0.6946
Grid {&#39;n_estimators&#39;: 70} : 0.7646 0.6931
Grid {&#39;n_estimators&#39;: 75} : 0.7653 0.6901
Grid {&#39;n_estimators&#39;: 80} : 0.7659 0.6916
Grid {&#39;n_estimators&#39;: 85} : 0.7644 0.6984
Grid {&#39;n_estimators&#39;: 90} : 0.7661 0.6976
Grid {&#39;n_estimators&#39;: 95} : 0.7642 0.7006
Grid {&#39;n_estimators&#39;: 100} : 0.7666 0.7014
Grid {&#39;n_estimators&#39;: 105} : 0.7662 0.6939
Grid {&#39;n_estimators&#39;: 110} : 0.7682 0.6924
Grid {&#39;n_estimators&#39;: 115} : 0.7697 0.6894
Grid {&#39;n_estimators&#39;: 120} : 0.7708 0.6954
Grid {&#39;n_estimators&#39;: 125} : 0.7699 0.6954
Grid {&#39;n_estimators&#39;: 130} : 0.7695 0.6954
Grid {&#39;n_estimators&#39;: 135} : 0.7702 0.6954
Grid {&#39;n_estimators&#39;: 140} : 0.7718 0.6969
Grid {&#39;n_estimators&#39;: 145} : 0.7713 0.6969
Grid {&#39;n_estimators&#39;: 150} : 0.7706 0.6946
Grid {&#39;n_estimators&#39;: 155} : 0.7720 0.6961
Grid {&#39;n_estimators&#39;: 160} : 0.7720 0.6984
Grid {&#39;n_estimators&#39;: 165} : 0.7714 0.6976
Grid {&#39;n_estimators&#39;: 170} : 0.7715 0.6969
Grid {&#39;n_estimators&#39;: 175} : 0.7725 0.6991
Grid {&#39;n_estimators&#39;: 180} : 0.7725 0.6999
Grid {&#39;n_estimators&#39;: 185} : 0.7709 0.6946
Grid {&#39;n_estimators&#39;: 190} : 0.7717 0.6976
Grid {&#39;n_estimators&#39;: 195} : 0.7719 0.6984
Grid {&#39;n_estimators&#39;: 200} : 0.7730 0.6969
</pre></div>
</div>
</div>
</div>
<p><strong>Step 7</strong> Apply the developed RF model to predict the activity of the <strong>training</strong> set compounds.</p>
<ul class="simple">
<li><p>Report the confusion matrix.</p></li>
<li><p>Report the accuracy, balanced accurayc, sensitivity, specificity, and auc-roc.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">)</span>    <span class="c1"># Apply the model to predict the training compound&#39;s activity.</span>

<span class="n">CMat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>    <span class="c1">#-- generate confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CMat</span><span class="p">)</span>    <span class="c1"># [[TN, FP], </span>
               <span class="c1">#  [FN, TP]]</span>
    
<span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>

<span class="n">sens</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>    <span class="c1"># TP / (FN + TP)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>    <span class="c1"># TN / (TN + FP )</span>
<span class="n">bacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">sens</span> <span class="o">+</span> <span class="n">spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">y_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span> <span class="n">X_train</span> <span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Accuracy          = &quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Balanced Accuracy = &quot;</span><span class="p">,</span> <span class="n">bacc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Sensitivity       = &quot;</span><span class="p">,</span> <span class="n">sens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Specificity       = &quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- AUC-ROC           = &quot;</span><span class="p">,</span> <span class="n">auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[573  95]
 [204 464]]
#-- Accuracy          =  0.7761976047904192
#-- Balanced Accuracy =  0.7761976047904191
#-- Sensitivity       =  0.6946107784431138
#-- Specificity       =  0.8577844311377245
#-- AUC-ROC           =  0.8431695740256016
</pre></div>
</div>
</div>
</div>
<p><strong>Step 8</strong> Apply the developed RF model to predict the activity of the <strong>test</strong> set compounds.</p>
<ul class="simple">
<li><p>Report the accuracy, balanced accurayc, sensitivity, specificity, and auc-roc.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write your code in this cell.</span>

<span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>    <span class="c1">#-- Apply the model to predict the test set compounds&#39; activity.</span>

<span class="n">CMat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>    <span class="c1">#-- generate confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">CMat</span><span class="p">)</span>    <span class="c1"># [[TN, FP], </span>
               <span class="c1">#  [FN, TP]]</span>
    
<span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="p">)</span>

<span class="n">sens</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">bacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">sens</span> <span class="o">+</span> <span class="n">spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">y_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span> <span class="n">X_test</span> <span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Accuracy          = &quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Balanced Accuracy = &quot;</span><span class="p">,</span> <span class="n">bacc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Sensitivity       = &quot;</span><span class="p">,</span> <span class="n">sens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- Specificity       = &quot;</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#-- AUC-ROC           = &quot;</span><span class="p">,</span> <span class="n">auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[484 122]
 [ 28  46]]
#-- Accuracy          =  0.7794117647058824
#-- Balanced Accuracy =  0.7101507448042101
#-- Sensitivity       =  0.6216216216216216
#-- Specificity       =  0.7986798679867987
#-- AUC-ROC           =  0.7588975113727588
</pre></div>
</div>
</div>
</div>
<p><strong>Step 9</strong> Read a recent paper published in <em>Chem. Res. Toxicol.</em> (<a class="reference external" href="https://doi.org/10.1021/acs.chemrestox.7b00037">https://doi.org/10.1021/acs.chemrestox.7b00037</a>) and answer the following questions (in no more than five sentences for each question).</p>
<ul class="simple">
<li><p>What different approaches did the paper take to develop prediction models (compared to those used in this notebook)?</p></li>
<li><p>How different are the models reported in the paper from those constructed in this paper (in terms of the performance measures)?</p></li>
<li><p>What would you do to develop models with improved performance?</p></li>
</ul>
<p>Write your answers in this cell.</p>
<ul class="simple">
<li></li>
<li></li>
<li></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lecture07.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Virtual Screening</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">8. Machine Learning Basics</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-bioactivity-data-from-pubchem">1. Import bioactivity data from PubChem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-number-of-compounds-for-each-activity-group">2. Check the number of compounds for each activity group</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#select-active-inactive-compounds-for-model-building">3. Select active/inactive compounds for model building</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drop-substances-without-associated-cids">3-(1) Drop substances without associated CIDs.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-cids-with-conflicting-activities">3-(2) Remove CIDs with conflicting activities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-redundant-data">3-(3) Remove redundant data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-numeric-activity-classes">3-(4) Adding “numeric” activity classes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-smaller-data-frame-that-only-contains-cids-and-activities">3-(5) Create a smaller data frame that only contains CIDs and activities.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-structure-information-for-each-compound-from-pubchem">4. Download structure information for each compound from PubChem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-maccs-keys-from-smiles">5. Generate MACCS keys from SMILES.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-activity-data-and-fingerprint-information">6. Merge activity data and fingerprint information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-for-model-building">7. Preparation for model building</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data-into-x-and-y">7-(1) Loading the data into X and y.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-zero-variance-features">7-(2) Remove zero-variance features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split-a-9-1-ratio">7-(3) Train-Test-Split (a 9:1 ratio)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#balance-the-training-set-through-downsampling">7-(4) Balance the training set through downsampling</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#build-a-model-using-the-training-set">9. 8. Build a model using the training set.</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-bayes">8-(1) Naive Bayes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-tree">8-(2) Decision Tree</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-building-through-cross-validation">9. Model building through cross-validation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">10. Exercises</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Belford et. al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>